link:https://maven.apache.org/surefire/maven-failsafe-plugin/[maven-failsafe-plugin]





[source,shell]
----
# maven 运行集成测试的时序
validate → compile → test → package → integration-test → verify → install → deploy

# 示例目录结果
src/
├── main/java/           # 主代码
└── test/java/
    ├── **/*Test.java    # 单元测试: surefire 运行
    └── **/*IT.java      # 集成测试: failsafe 运行
----

示例配置 pom.xml

[source,xml]
----
<build>
    <plugins>
        <!-- 单元测试插件（已存在） -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <configuration>
                <argLine>-Dautoconfig.skip=true -Dfile.encoding=UTF-8 @{argLine}</argLine>
            </configuration>
        </plugin>

        <!-- 集成测试插件 -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-failsafe-plugin</artifactId>
            <version>3.5.4</version>
            <executions>
                <execution>
                    <goals>
                        <goal>integration-test</goal>
                        <goal>verify</goal>
                    </goals>
                </execution>
            </executions>
            <configuration>
                <argLine>@{argLine}</argLine>
                <systemPropertyVariables>
                <project.build.directory>${project.build.directory}</project.build.directory>
                <project.build.finalName>${project.build.finalName}</project.build.finalName>
                </systemPropertyVariables>
            </configuration>
        </plugin>
    </plugins>
</build>
----

是集成测试case

XxxIT.java

[source,java]
----
package me.test;

import static org.junit.jupiter.api.Assertions.*;

import java.io.IOException;
import org.apache.commons.exec.CommandLine;
import org.apache.commons.exec.DefaultExecutor;
import org.apache.commons.exec.PumpStreamHandler;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.io.TempDir;
import java.io.ByteArrayOutputStream;
import java.nio.file.Path;

/**
 * 集成测试：基于打包后的 jar 包运行
 */
public class JarExecutionIT {

/**
 * junit
 */
    @Test
    public void testJarExecution(@TempDir Path tempDir) throws IOException, InterruptedException {
        // 获取打包后的 jar 路径
        String jarPath = System.getProperty("project.build.directory") + "/"
                       + System.getProperty("project.build.finalName") + ".jar";

        // 构建命令
        CommandLine cmdLine = new CommandLine("java");
        cmdLine.addArgument("-jar");
        cmdLine.addArgument(jarPath);
        cmdLine.addArgument("your-command");
        cmdLine.addArgument("arg1");

        // 执行命令
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        DefaultExecutor executor = new DefaultExecutor();
        executor.setStreamHandler(new PumpStreamHandler(outputStream));

        int exitCode = executor.execute(cmdLine);

        // 验证结果
        assertEquals(0, exitCode, "命令执行应该成功");
        String output = outputStream.toString();
        assertTrue(output.contains("expected output"), "输出应该包含预期内容");
    }
}

----

相关命令
[source,shell]
----
# 只运行单元测试
mvn test

# 运行单元测试 + 集成测试, 如果报错，则阻断
mvn verify

# 跳过集成测试
mvn verify -DskipITs

# 只运行集成测试，不阻断
mvn failsafe:integration-test

# 运行单个集成测试case
mvn failsafe:integration-test -Dit.test=DemoCommandIT#testJarExecution
----

如何跳过测试？请参考 link:maven-surefire-plugin[maven-surefire-plugin] 相关总结。



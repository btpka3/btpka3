




[source,shell]
----

# 基本用法
find <起始目录> <表达式>

----




== 表达式


[source,shell]
----
# 按文件名搜索（区分大小写）
find . -name "*.log"
# 按文件名搜索（不区分大小写）
find . -iname "*.log"


# 按路径搜索: 模式匹配
find . -path "*/log/*.log"
# 按路径搜索: 正则匹配
find . -regex ".*\.\(jpg\|png\)$"

# 按文件类型搜索.
# f : 普通文件
# d : 目录
# l：符号链接
# s：套接字
# b：块设备
# c：字符设备
# p：命名管道
find . -type f     # 查找所有文件类型的

# 按文件大小搜索
# -size <+/->n[单位]
# 单位: c-字节, k-KB, M-MB, G-GB
find . -size +100M  # 大于 100M的
find . -size -100M  # 小于 100M的

# 按时间搜索
find . -mtime -7    # 按修改时间（天级别）：7天内修改的文件
find . -mtime +7    # 按修改时间（天级别）：7天前修改的文件
find . -atime -7    # 按访问时间（天级别）：7天内访问的文件
find . -atime +7    # 按访问时间（天级别）：7天前访问的文件
find . -ctime -7    # 按状态变更时间（天级别）：7天内状态变更的
find . -ctime +7    # 按状态变更时间（天级别）：7天前状态变更的
find . -mmin  -7    # 按修改时间（分钟级）：7分钟内修改的文件
find . -mmin  +7    # 按修改时间（分钟级）：7分钟前修改的文件

# 按权限搜索
find . -perm 644    # 权限为644的文件
find . -user admin  # 用户 admin 所有的
find . -group admin # 用户组 admin 所有的

# 深度空值
find . -maxdepth 1  # 设置最小深度
find . -maxdepth 3  # 设置最大深度


# 逻辑组合
# -and, -a  # 与（默认）
# -or, -o   # 或
# -not, !   # 非
# ()        # 分组（需转义）


----

== 动作

[source,shell]
----


-print                      # 默认动作，打印完整路径
-print0                     # 用NULL分隔结果（适合处理含空格文件名）
-exec xxx-command {} \;     # 对每个文件执行给定命令， {} 会呗替换为文件路径
-exec command {} +          # 一次传递多个文件
-ok                         # 交互式确认后执行
-delete                     # 直接删除文件
-ls                         # 显示详细文件信息

# 找到包含给定文本的日志文件
find $(pwd) -type f -name "*.log" -exec grep -rnwH -F "tomcat/bin/tomcat-juli.jar" {} \;

sudo find  /  -type f -name "*.log" -exec grep -rnwH -F "/usr/bin/curl http://33.40.87.131:7001/shutdown.htm" {} \;

----




== 示例

[source,shell]
----

# 排除目录
find / \( -path "/proc" -o -path "/sys" \) -prune -o -print


# 压缩所有日志文件。
find /var/log -name "*.log" -exec gzip {} +  # 压缩所有日志


# 找到包含给定文本的日志文件
find $(pwd) -type f -name "*.log" -exec grep -rnwH -F "tomcat/bin/tomcat-juli.jar" {} \;

sudo find  / \( -path "/proc" -o -path "/sys" \) -prune -type f -name "*.log" -exec grep -rnwH -F "/usr/bin/curl http://33.40.87.131:7001/shutdown.htm" {} \;



sudo find  /   -type f -name "*.log" -exec grep -rnwH -F "/usr/bin/curl http://33.40.87.131:7001/shutdown.htm" {} \;




----

[source,shell]
----
# 按照文件的大小排序
find . -type f |xargs ls -l -h | sort -b -h -k5

# 叶子目录
find dir -type d | sort -r | awk 'a!~"^"$0{a=$0;print}' | sort
# 查找 "md" 结尾的文件，并且路径不包含 "node_modules"、"_book"
find . -type f \
    -not -path "*/node_modules*" \
    -and  -not -path "*/_book/*" \
    -and -name "*.md"

# 统计当前目录下目录的数量（不含隐藏目录和当前目录本身）
find $PWD -maxdepth 1 -type d  ! \( -path '*/\.*' -o -path $PWD \)

# 有多个java命令时，把

MAX_JAVA=$(find /opt/taobao/install/ -type f -name java ! \( -path '*/jre/*' -a  -path '*/ajdk*' \) \
-exec bash -c 'echo {} $({} -version 2>&1 | awk -F\" "/version/ {print \$2}" | awk -F. "{print \$1}")' \; \
| sort -k 2 -n -r \
| head -n 1 \
| awk '{print $1}')
# echo "with java version is : ${MAX_JAVA}"
if [[ -n "${MAX_JAVA}"]] ; then
    export JAVA_HOME="$(dirname $(dirname ${MAX_JAVA}))"
    # 注意：左变量前后有刻意加分号，以便进行正则匹配
    if [[ ":$PATH:" != *":$JAVA_HOME/bin:"* ]]; then
        export PATH=$JAVA_HOME/bin:$PATH
    fi
fi



MAX_JAVA=$(find /tmp -type f -name java ! \( -path '*/jre/*' -a  -path '*/ajdk*' \) \
-exec bash -c 'echo {} $({} -version 2>&1 | awk -F\" "/version/ {print \$2}" | awk -F. "{print \$1}")' \; \
| sort -k 2 -n -r \
| head -n 1 \
| awk '{print $1}')

----

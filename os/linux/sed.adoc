
- https://www.gnu.org/software/sed/manual/sed.html[sed, a stream editor]
- https://docstore.mik.ua/orelly/unix/sedawk/appa_03.htm[Command Summary for sed]
- link:https://pubs.opengroup.org/onlinepubs/9699919799/utilities/sed.html[sed]


== 选择匹配的行


[source,shell]
----
# 未设置行号范围，则是所有航： 替换所有行 "hi" -> world
cat <<EOF |
aaa hi
bbb hi
ccc hi
EOF
sed 's/hi/world/'

# 按行号选择： 替换第2行 "hi" -> world
cat <<EOF |
aaa hi
bbb hi
ccc hi
EOF
sed '2s/hi/world/'

# 按行号选择： 替换第2~4行 "hi" -> world
cat <<EOF |
aaa hi
bbb hi
ccc hi
ddd hi
eee hi
EOF
sed '2,4s/hi/world/'

# 按行号选择：取反：替换第2~4行以外的行 "hi" -> world
cat <<EOF |
aaa hi
bbb hi
ccc hi
ddd hi
eee hi
EOF
sed '2,4!s/hi/world/'

# 替换最后一行 "hi" -> world
cat <<EOF |
aaa hi
bbb hi
ccc hi
EOF
sed '$s/hi/world/'

# 按正则：在包含 "b" 行中：替换 "hi" -> world
cat <<EOF |
aaa hi
bbb hi
ccc hi
EOF
sed '/b/s/hi/world/'

# 按正则：在不包含 "b" 行中：替换 "hi" -> world
cat <<EOF |
aaa hi
bbb hi
ccc hi
EOF
sed '/b/!s/hi/world/'

# basename

cat <<EOF |
/WEB-INF/lib/a.jar
/WEB-INF/lib/b.jar
/WEB-INF/lib/c.jar
EOF
sed 's!.*/!!'
#说明：前一行 s 后面的 ! 是 正则的分界符，如果使用 '\' 作为分界符，就需要对路径分隔符做转义
#sed 's/.*\///'



# 按正则：注意: {}()?+ 这种正则里常用的字符，使用时需要加 '\' 前缀才能表达正则的含义，没有该前缀就表示其字符本身。
cat <<EOF |
aaa hi
bbb{}()?+ hi
ccc hi
EOF
sed '/^b\+{}()?+ hi$/s/hi/world/'

# GNU sed 扩展: 按照 first~step 选择行: 1~2 表示选择所有奇数行
cat <<EOF |
aaa hi
bbb hi
ccc hi
ddd hi
eee hi
EOF
sed '1~2s/hi/world/'




----




## 在前面插入

[source,shell]
----
# 在第二行插入 "111\n", 注意:  GNU版本的 sed 才允许将要插入的文本放在 /i 的同一行
cat <<EOF |
aaa
bbb
ccc
EOF
sed '2i\
111
'

cat <<EOF |
aaa
bbb
ccc
EOF
sed -r '2i\
111\n'



# 在所有 "bbb" 前插入 "111\n"
cat <<EOF |
aaa
bbb
bbb
ccc
EOF
sed '/bbb/i\
111
'
----

## 在前面插入

[source,shell]
----
# 在第二行后插入 "111\n", 注意:  GNU版本的 sed 才允许将要插入的文本放在 /a 的同一行
cat <<EOF |
aaa
bbb
ccc
EOF
sed '2a\
111
'


# 在所有 "bbb" 前插入 "111\n"
cat <<EOF |
aaa
bbb
bbb
ccc
EOF
sed '/bbb/a\
111
'
----


## 字符串替换

[source,shell]
----
cat <<EOF |
aaa
bbb
bbb
ccc
EOF
sed 's/^bbb$/111/'
----


[source,shell]
----
cat <<EOF |
#1catalina.org.apache.juli.AsyncFileHandler.directory = \${catalina.base}/logs
#2localhost.org.apache.juli.AsyncFileHandler.directory = \${catalina.base}/logs
EOF
sed -i 's/\${catalina.base}\/logs/\${catalina.logs}/g' logging.properties

sed -i 's/\${catalina.base}\/logs/\${catalina.logs}/g' logging.properties
# mysql ddl 全局重置 AUTO_INCREMENT 为 1
# 如果MacOS 上执行sed, -i 后面需要增加 `''` 参数
sed -i '' 's/ AUTO_INCREMENT=[0-9]* / AUTO_INCREMENT=1 /g'  ddl.sql
----


## 删除

[source,shell]
----
# 删除第一行
cat <<EOF |
aaa
bbb
ccc
EOF
sed '1d'
----



## 多文件批量字符串替换

[source,shell]
----
# GNU 版本的 sed
## 格式
find ./ -type f -exec sed -i 's/old_string/new_string/g' {} \;


# macOs 版本的 sed
## 格式
find ./ -type f -exec sed -i '' -e 's/old_string/new_string/g' {} \;

## 示例: 将 gradle 文件 中maven 仓库地址 从 http 协议改成 https 协议
find ./mqtt/my-mqtt/ -type f -name "*.gradle" -exec sed -i '' -e  's/http:\/\/maven.aliyun.com/https:\/\/maven.aliyun.com/g' {} \;
find . -type f -name "*.gradle" -exec sed -i '' -e 's/http:\/\/maven.aliyun.com/https:\/\/maven.aliyun.com/g' {} \;

find . -type f -name "*.gradle" | xargs grep "http://maven.aliyun.com"
----


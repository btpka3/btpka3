

link:https://help.aliyun.com/zh/arms/application-monitoring/user-guide/manually-install-arms-agent-for-java-applications[手动安装探针]

- link:https://help.aliyun.com/zh/arms/application-monitoring/user-guide/trace-query[调用链路查询]
- link:https://help.aliyun.com/zh/arms/application-monitoring/developer-reference/use-trace-explorer-to-query-traces[调用链分析查询用法说明]
- link:https://help.aliyun.com/zh/arms/application-monitoring/developer-reference/trace-explorer-parameters[调用链分析参数说明]


[source,shell]
----
mkdir -p /tmp/b/
cd /tmp/b
# 下载
wget https://arms-apm-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/4.2.3/AliyunJavaAgent.zip -O AliyunJavaAgent-cn-hangzhou.zip
wget https://arms-apm-cn-beijing.oss-cn-beijing.aliyuncs.com/4.2.3/AliyunJavaAgent.zip   -O AliyunJavaAgent-cn-beijing.zip

#


# 检查文件内容
unzip AliyunJavaAgent-cn-hangzhou.zip -d AliyunJavaAgent-cn-hangzhou
unzip AliyunJavaAgent-cn-beijing.zip  -d AliyunJavaAgent-cn-beijing

zipinfo -1 AliyunJavaAgent-cn-beijing/AliyunJavaAgent/aliyun-java-agent.jar

# 解压

# 检查配置内容
JAR=AliyunJavaAgent-cn-beijing/AliyunJavaAgent/aliyun-java-agent.jar
unzip -p ${JAR} io/opentelemetry/javaagent/config/env/cloud_cn-beijing.properties
unzip -p ${JAR} io/opentelemetry/javaagent/config/env/cloud_cn-hangzhou.properties
unzip -p ${JAR} io/opentelemetry/javaagent/config/env/cloud_cn-shanghai.properties
# 注意：从不同地域下载的jar包，至少该默认配置不同
unzip -p ${JAR} io/opentelemetry/javaagent/config/default.properties



> /tmp/a.txt

grep . a.txt  \
|grep -v -E META-INF \
|grep -v -E '\.(so|jnilib|dylib|dll|a|html|renamed|template|gif|png|svg|classdata|kotlin_metadata|txt|lombok|class|proto)$' \
|grep -v -E '/$' \
|grep -v -E embedded-jars \
|grep -v -E '^inst/test_' \

AliyunJavaAgent

unzip -p aliyun-java-agent.jar io/opentelemetry/javaagent/config/env/cloud_cn-guangzhou.properties


-javaagent:/{user.workspace}/AliyunJavaAgent/aliyun-java-agent.jar
-Darms.licenseKey=g5eyn4uqly@5e15efe3b4afb3b
-Darms.appName=my-service
----


== 配置

参考环境变量： JAVA_TOOL_OPTIONS

== 相关日志

/home/admin/logs/arms/*
/home/admin/logs/arms_log/*

v3.x
path/AliyunJavaAgent/logs/boot.log #比如: /home/admin/bin/AliyunJavaAgent/logs/boot.log

v4.x:
/home/admin/logs/boot.log

[source,plain]
----
2025-07-21 20:07:59.273|22|warn|||[AliyunPropertyValidator]read file /etc/podinfo/labels failed, Ignore... reason: /etc/podinfo/labels/class java.nio.file.NoSuchFileException
2025-07-21 20:07:59.274|22|warn|||[AliyunPropertyValidator]read file /etc/podinfo/annotations failed, Ignore... reason: /etc/podinfo/annotations/class java.nio.file.NoSuchFileException
2025-07-21 20:07:59.468|26|warn|||[AliyunPropertyValidator]read file /etc/podinfo/annotations failed, Ignore... reason: /etc/podinfo/annotations/class java.nio.file.NoSuchFileException
2025-07-21 20:07:59.471|26|warn|||Fetch HostMetaData Info Success: HostMetaData(hostName=xxx-xxx-xxx, instanceId=, instanceType=null, mac=null, serialNumber=null, account=, imageId=null, regionId=, zoneId=, privateIp=, vpcId=)
2025-07-21 20:07:59.580|22|warn|||Load Aliyun Java Agent version: 4.2.3, report to region: cn-beijing.   // ⭕️⭕️⭕️
2025-07-21 20:07:59.603|22|warn|||[MSE] micro service degrade rule changed, null
2025-07-21 20:07:59.637|50|warn|||[EmbeddedJarManager] start extract embedded jars
2025-07-21 20:07:59.815|22|warn|||[SENDER] regionId is cn-beijing , debugHost: null
2025-07-21 20:07:59.819|22|warn|||Micro Service Event Report started.
2025-07-21 20:08:00.204|22|warn|||[Diamond] receive CP Config:                  // ⭕️： 为了方便查看，这里手动换行了
profiler.enable=false,
profiler.cp.enable=false,
profiler.cp.cpuEnable=false,
profiler.cp.allocEnable=false,
profiler.cp.wallClockEnable=false,
profiler.cp.otherEnable=false,
profiler.cp.allowIPs=,
profiler.cp.allowNetwork=
2025-07-21 20:08:00.211|66|warn|||[CP] Successfully to pass jdk environment check in onConfigUpdated, forceEnable=false, isSafeJvm=true, isCPEnable=false, jdkVersion=11.0.25.25-AJDK, jvmName=OpenJDK 64-Bit Server VM, config=ContinuousProfilingModuleState{configEnable=true, cpEnable=false, cpuEnable=false, allocEnable=false, wallClockEnable=false, otherEnable=false, allowIPs='', allowNetwork='', wallClockThreads=16, wallClockInterval=10, cpuInterval=10, allocInterval=1024, forceEnable=false, mode=GZIP}
2025-07-21 20:08:00.676|22|warn|||instrumentation config: InstrumentationState{  // ⭕️： 为了方便查看，这里手动换行了
    logger=io.opentelemetry.javaagent.tooling.arms.logger.AliyunJavaAgentLoggerImpl@300ca97f,
    hsfEnable=true,
    dubboEnable=true,
    googleHttpClientEnable=true,
    httpClient3Enable=true,
    httpClient4Enable=true,
    jdkHttpEnable=true,
    jettyEnable=true,
    mybatisEnable=true,
    okhttpEnable=true,
    redisEnable=true,
    springEnable=true,
    springBootEnable=true,
    tomcatEnable=true,
    mongodbEnable=true,
    lettuceEnable=true,
    grpcEnable=true,
    memcachedEnable=true,
    druidEnable=true,
    elasticJobEnable=true,
    elasticSearchEnable=true,
    executorsEnable=true,
    hikaricpEnable=true,
    hystrixEnable=true,
    influxdbEnable=true,
    kafkaEnable=true,
    log4jEnable=true,
    logbackEnable=true,
    microServiceEnable=true,
    mysqlEnable=true,
    oracleEnable=true,
    postgresqlEnable=true,
    nettyEnable=true,
    playEnable=true,
    opentelemetryEnable=true,
    onsClientEnable=true,
    quartzEnable=true,
    reactorEnable=true,
    redissonEnable=true,
    rxjavaEnable=true,
    rocketmqEnable=true,
    rabbitmqEnable=true,
    schedulerxEnable=true,
    servletEnable=true,
    undertowEnable=true,
    vertxEnable=true,
    dynamicLogEnable=true,
    cassandraEnable=true,
    xxlJobEnable=true
}

2025-07-21 20:08:01.285|50|warn|||extractEmbedJar to /home/admin/xxxAppName/.default/temp/aliyun-java-agent-pid-f35c5676-2703-4689-a00d-75cd8faeae16/
2025-07-21 20:08:01.285|50|warn|||[EmbeddedJarManager] end extract embedded jars
2025-07-21 20:08:01.289|58|warn|||[MSE] [SENTINEL] [AGENT] [INIT] [INFO] MseSentinelJarLoader is registered
2025-07-21 20:08:01.393|22|warn|||[Instrumentation]Applying instrumentation success: executors [class io.opentelemetry.javaagent.instrumentation.executors.ExecutorsInstrumentationModule] on jdk.internal.loader.ClassLoaders$AppClassLoader@75412c2f
2025-07-21 20:08:01.409|22|warn|||[Instrumentation]Applying instrumentation success: java-util-logging [class io.opentelemetry.javaagent.instrumentation.jul.JavaUtilLoggingInstrumentationModule] on jdk.internal.loader.ClassLoaders$AppClassLoader@75412c2f
2025-07-21 20:08:01.429|22|warn|||[Instrumentation]Applying instrumentation success: executors [class io.opentelemetry.javaagent.instrumentation.executors.ExecutorsInstrumentationModule] on io.opentelemetry.javaagent.bootstrap.AgentClassLoader$BootstrapClassLoaderProxy@3fc5bb6f
2025-07-21 20:08:01.545|22|warn|||[Instrumentation]Applying instrumentation success: jdk-net-socket [class io.opentelemetry.javaagent.instrumentation.jdk.JdkNetInstrumentationModule] on io.opentelemetry.javaagent.bootstrap.AgentClassLoader$BootstrapClassLoaderProxy@3fc5bb6f
----

== 相关命令

[source,shell]
----
# 搜索 "boot.log", 排查相关日志配置
ugrep -z "boot.log" aliyun-java-agent.jar
----

== arthas
[source,shell]
----
# 检查相关类，并反编译
sc -d io.opentelemetry.javaagent.logging.arms.ArmsLogger
# 获取 BASE_LOG_DIR 的值，比如: /home/admin/logs/
ognl -c 1a3d9f1 '@io.opentelemetry.javaagent.logging.arms.ArmsLogger@BASE_LOG_DIR'
# 检查系统属性 JM.LOG.PATH 的值。 如果有值，比如（/home/admin/logs），
# 则阿里云 ARMS 的JavaAgent :会将该目录作为日志的目录，
# 否则使用 aliyun-java-agent.jar 的父目录 下的 logs 作为 日志根目录。
sysprop JM.LOG.PATH

sc -d io.opentelemetry.javaagent.logging.arms.ArmsLoggerUtils
sc -d io.opentelemetry.javaagent.bootstrap.JavaagentFileHolder   # JavaagentFileHolder

# 获取 java agent jar包的路径，比如: /opt/arms/AliyunJavaAgent/aliyun-java-agent.jar
ognl -c '@io.opentelemetry.javaagent.bootstrap.JavaagentFileHolder@javaagentFile'
----




== arms-agent.properties
